<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 스트렝스모임 실시간 회고록</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&family=Noto+Sans+KR:wght@300;400;700&display=swap');

        :root {
            --bg-color: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.85);
            --text-color: #e2e8f0;
            --accent-color: #fbbf24;
            --secondary-accent: #38bdf8;
            --input-bg: rgba(0, 0, 0, 0.4);
        }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: var(--text-color);
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0; padding: 0;
            min-height: 100vh;
            display: flex; justify-content: center; align-items: flex-start;
        }

        .snowflake { position: fixed; top: -10px; color: #fff; pointer-events: none; animation: fall linear infinite; z-index: 1; }
        @keyframes fall { to { transform: translateY(110vh); } }

        .container {
            width: 95%; max-width: 600px;
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            padding: 30px; border-radius: 24px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1);
            z-index: 10; text-align: center;
            margin: 40px 10px; position: relative;
        }

        h1, h2, h3 { font-family: 'Noto Serif KR', serif; color: var(--accent-color); }
        .subtitle { color: #94a3b8; margin-bottom: 30px; font-size: 0.9rem; }

        /* 입력 폼 */
        .question-card { background: rgba(0,0,0,0.25); padding: 18px; border-radius: 15px; margin-bottom: 20px; text-align: left; border: 1px solid rgba(255,255,255,0.05); }
        .question-label { display: block; margin-bottom: 10px; font-weight: bold; color: #f1f5f9; font-size: 1rem; line-height: 1.4; }
        textarea { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: var(--input-bg); color: white; font-size: 1rem; box-sizing: border-box; outline: none; font-family: inherit; min-height: 80px; }

        /* 버튼 */
        .btn { background: var(--accent-color); color: #0f172a; font-weight: bold; border: none; padding: 15px; border-radius: 12px; cursor: pointer; width: 100%; font-size: 1rem; margin-top: 10px; transition: 0.3s; }
        .btn:hover { opacity: 0.9; transform: translateY(-2px); }
        .btn-sub { background: rgba(255,255,255,0.1); color: white; font-size: 0.8rem; padding: 10px; margin-top: 10px; border: none; border-radius: 8px; cursor: pointer; width: 100%; }

        /* 결과 대시보드 */
        .tab-container { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { flex: 1; padding: 12px; border-radius: 10px; cursor: pointer; background: rgba(0,0,0,0.3); color: #64748b; border: 1px solid transparent; }
        .tab-btn.active { background: rgba(251, 191, 36, 0.2); color: var(--accent-color); border-color: var(--accent-color); font-weight: bold; }

        .grid-menu { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .grid-item { background: rgba(255,255,255,0.05); padding: 15px 5px; border-radius: 10px; cursor: pointer; font-size: 0.9rem; transition: 0.2s; border: 1px solid rgba(255,255,255,0.1); }
        .grid-item.active { border-color: var(--accent-color); color: var(--accent-color); background: rgba(251,191,36,0.1); }

        /* 코멘트 스타일 */
        .comment-section { margin-top: 15px; background: rgba(0,0,0,0.3); border-radius: 10px; padding: 12px; }
        .comment-item { font-size: 0.85rem; border-bottom: 1px solid rgba(255,255,255,0.05); padding: 8px 0; text-align: left; }
        .comment-user { color: var(--secondary-accent); font-weight: bold; margin-right: 8px; }
        .comment-input-group { display: flex; gap: 5px; margin-top: 10px; }
        .comment-input { flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; border-radius: 6px; padding: 8px; font-size: 0.85rem; outline: none; }
        .comment-btn { background: var(--secondary-accent); border: none; color: white; border-radius: 6px; padding: 0 15px; cursor: pointer; font-size: 0.85rem; }

        .hidden { display: none; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div id="snow-container"></div>
    <div class="container fade-in">
        
        <div id="page-login">
            <h1>2025 회고록</h1>
            <p class="subtitle">스트렝스모임 실시간 공유</p>
            <input type="text" id="username" placeholder="본인 이름을 입력하세요" style="width:100%; padding:15px; border-radius:12px; border:none; background:var(--input-bg); color:white; font-size:1.2rem; text-align:center; box-sizing:border-box; outline:none; border: 1px solid rgba(251,191,36,0.3);">
            <button class="btn" onclick="checkUser()">회고 시작하기</button>
            <p style="margin-top:20px; font-size:0.8rem; color:#64748b;">멤버: 경빈, 민욱, 왕근, 재규, 정민, 무철, 재호, 건욱, 한슬, 국영, 병선</p>
        </div>

        <div id="page-quiz" class="hidden">
            <h2 id="display-name"></h2>
            <div id="quiz-container"></div>
            <button class="btn" onclick="saveToFirebase()">기록 저장하고 결과 보기</button>
        </div>

        <div id="page-dashboard" class="hidden">
            <h2>모두의 2025년</h2>
            <div class="tab-container">
                <div class="tab-btn active" id="tab-person" onclick="switchTab('person')">사람별</div>
                <div class="tab-btn" id="tab-question" onclick="switchTab('question')">문항별</div>
            </div>
            <div id="menu-person" class="grid-menu"></div>
            <div id="menu-question" class="hidden"></div>
            <button class="btn-sub" onclick="changePage('page-quiz')">내 답변 수정하기</button>
        </div>

        <div id="page-detail" class="hidden">
            <h3 id="detail-title"></h3>
            <div id="detail-content-list"></div>
            <button class="btn-sub" onclick="changePage('page-dashboard')">리스트로 돌아가기</button>
        </div>
    </div>

    <script>
        // --- Firebase 설정 ---
        const firebaseConfig = {
            apiKey: "AIzaSyANwFDqOLJunf7_RHvn0cGG4UGD2pSs1t4",
            authDomain: "strength-2025.firebaseapp.com",
            databaseURL: "https://strength-2025-default-rtdb.firebaseio.com",
            projectId: "strength-2025",
            storageBucket: "strength-2025.firebasestorage.app",
            messagingSenderId: "235067837158",
            appId: "1:235067837158:web:a0f197b53a5c60b68c0927"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const members = ["경빈", "민욱", "왕근", "재규", "정민", "무철", "재호", "건욱", "한슬", "국영", "병선"];
        const questions = ["올해 가장 좋았던 카페", "올해의 best 소비", "올해의 worst 소비", "가장 자주 들은 올해의 노래", "올해 가장 인상 깊었던 영화", "올해 가장 인상 깊었던 책 혹은 구절", "올해의 선물 (가장 감동 받은 선물)", "이번 연도의 가장 큰 도전", "반면에 이번 연도에 실패한 것", "2025년 중 한순간으로 돌아간다면?", "이번 연도에 만난 새로운 인연", "올해 먹었던 것 중 가장 맛있었던 것은?", "올해 나의 가장 큰 고민", "나 자신이 작년에 비해 변화한 점", "올해 가장 힘들었던 순간 / 극복 방법", "올해 눈물을 흘린 적이 있었다면?", "올해 찍은 사진 중 마음에 드는 것", "올해 새로 발견한 취미나 관심사", "올해 나에게 큰 영향을 준 인물", "올해 느꼈던 감사한 일 3가지", "올해 내가 가장 빠진 밈 / 콘텐츠", "올해 나를 위해 한 가장 큰 투자", "올해의 소확행", "올해 가장 기억에 남는 순간", "올해 깨달은 교훈", "아, 이건 하길 잘했다!", "내년에는 꼭 이루고 싶은 것", "올해를 한 문장으로 표현한다면?", "2025년의 나에게 칭찬 한 마디", "2026년의 나에게 해주고 싶은 말"];

        let currentUser = "";

        // 눈 배경
        function createSnow() {
            const container = document.getElementById('snow-container');
            for(let i=0; i<30; i++){
                const snow = document.createElement('div');
                snow.className = 'snowflake'; snow.innerHTML = '❄';
                snow.style.left = Math.random() * 100 + 'vw';
                snow.style.animationDuration = (Math.random() * 3 + 5) + 's';
                snow.style.opacity = Math.random();
                container.appendChild(snow);
            }
        }
        createSnow();

        function checkUser() {
            const name = document.getElementById('username').value.trim();
            if(members.includes(name)) {
                currentUser = name;
                document.getElementById('display-name').innerText = currentUser + "님의 회고";
                renderQuiz();
                // 이미 데이터가 있는지 확인 후 페이지 결정
                db.ref('reviews/' + currentUser).once('value', snapshot => {
                    if(snapshot.exists()) {
                        initDashboard();
                        changePage('page-dashboard');
                    } else {
                        changePage('page-quiz');
                    }
                });
            } else { alert("멤버 이름을 정확히 입력해주세요!"); }
        }

        function renderQuiz() {
            const container = document.getElementById('quiz-container');
            container.innerHTML = "";
            db.ref('reviews/' + currentUser).once('value', snapshot => {
                const saved = snapshot.val() || {};
                questions.forEach((q, i) => {
                    container.innerHTML += `<div class="question-card"><label class="question-label">${i+1}. ${q}</label>
                    <textarea id="ans-${i}">${saved[i] || ""}</textarea></div>`;
                });
            });
        }

        function saveToFirebase() {
            const answers = {};
            questions.forEach((_, i) => answers[i] = document.getElementById(`ans-${i}`).value);
            db.ref('reviews/' + currentUser).set(answers);
            alert("서버에 저장되었습니다!");
            initDashboard();
            changePage('page-dashboard');
        }

        function initDashboard() {
            const pMenu = document.getElementById('menu-person');
            pMenu.innerHTML = "";
            members.forEach(m => {
                const item = document.createElement('div');
                item.className = 'grid-item';
                item.innerText = m;
                item.onclick = () => showDetailByPerson(m);
                pMenu.appendChild(item);
            });

            const qMenu = document.getElementById('menu-question');
            qMenu.innerHTML = "";
            questions.forEach((q, i) => {
                const item = document.createElement('div');
                item.className = 'grid-item';
                item.style.gridColumn = "span 3";
                item.style.textAlign = "left";
                item.innerText = (i+1) + ". " + q;
                item.onclick = () => showDetailByQuestion(i);
                qMenu.appendChild(item);
            });
        }

        function showDetailByPerson(member) {
            db.ref('reviews/' + member).once('value', snapshot => {
                const data = snapshot.val();
                const container = document.getElementById('detail-content-list');
                document.getElementById('detail-title').innerText = member + "님의 기록";
                container.innerHTML = "";

                if(!data) {
                    container.innerHTML = "<p style='padding:40px;'>아직 작성하지 않았습니다.</p>";
                } else {
                    questions.forEach((q, i) => {
                        const qCard = document.createElement('div');
                        qCard.className = 'question-card';
                        qCard.innerHTML = `
                            <div style="color:var(--accent-color); font-size:0.85rem; margin-bottom:8px;">Q. ${q}</div>
                            <div style="font-size:1.1rem; line-height:1.6; white-space:pre-wrap;">${data[i] || "-"}</div>
                            <div class="comment-section" id="comments-${member}-${i}">로딩 중...</div>
                        `;
                        container.appendChild(qCard);
                        loadComments(member, i);
                    });
                }
                changePage('page-detail');
            });
        }

        function loadComments(member, qIdx) {
            const cSection = document.getElementById(`comments-${member}-${qIdx}`);
            db.ref(`comments/${member}/${qIdx}`).on('value', snapshot => {
                let html = '';
                snapshot.forEach(child => {
                    const c = child.val();
                    html += `<div class="comment-item"><span class="comment-user">${c.user}</span>${c.text}</div>`;
                });
                html += `
                    <div class="comment-input-group">
                        <input type="text" class="comment-input" id="input-${member}-${qIdx}" placeholder="댓글 입력...">
                        <button class="comment-btn" onclick="addComment('${member}', ${qIdx})">전송</button>
                    </div>
                `;
                cSection.innerHTML = html;
            });
        }

        function addComment(targetMember, qIdx) {
            const input = document.getElementById(`input-${targetMember}-${qIdx}`);
            const text = input.value.trim();
            if(!text) return;
            db.ref(`comments/${targetMember}/${qIdx}`).push({ user: currentUser, text: text });
            input.value = "";
        }

        function showDetailByQuestion(qIdx) {
            const container = document.getElementById('detail-content-list');
            document.getElementById('detail-title').innerText = questions[qIdx];
            container.innerHTML = "<p style='margin-bottom:20px; color:#94a3b8;'>멤버별 답변 모아보기</p>";
            
            members.forEach(m => {
                db.ref('reviews/' + m).once('value', snapshot => {
                    const data = snapshot.val();
                    const ans = (data && data[qIdx]) ? data[qIdx] : "미작성";
                    container.innerHTML += `
                        <div class="question-card">
                            <div class="question-label" style="color:var(--secondary-accent)">${m}</div>
                            <div style="white-space:pre-wrap;">${ans}</div>
                        </div>`;
                });
            });
            changePage('page-detail');
        }

        function switchTab(mode) {
            document.getElementById('tab-person').classList.toggle('active', mode==='person');
            document.getElementById('tab-question').classList.toggle('active', mode==='question');
            document.getElementById('menu-person').classList.toggle('hidden', mode!=='person');
            document.getElementById('menu-question').classList.toggle('hidden', mode!=='question');
        }

        function changePage(id) {
            ['page-login', 'page-quiz', 'page-dashboard', 'page-detail'].forEach(p => document.getElementById(p).classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            window.scrollTo(0,0);
        }
    </script>
</body>
</html>
